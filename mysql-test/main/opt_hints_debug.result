CREATE TABLE t1 (i INT, j INT);
CREATE INDEX i1 ON t1(i);
CREATE INDEX i2 ON t1(j);

# empty hint comment is ok:

SELECT /*+*/ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '*/' at line 1
SELECT /*+ */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '*/' at line 1
SELECT /*+ * ** / // /* */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '* ** / // /* */ 1' at line 1
SELECT /*+ @ */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '@ */ 1' at line 1
SELECT /*+ @foo */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '@foo */ 1' at line 1
SELECT /*+ foo@bar */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near 'foo@bar */ 1' at line 1
SELECT /*+ foo @bar */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near 'foo @bar */ 1' at line 1
SELECT /*+ `@` */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '@` */ 1' at line 1
SELECT /*+ `@foo` */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '@foo` */ 1' at line 1
SELECT /*+ `foo@bar` */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near 'foo@bar` */ 1' at line 1
SELECT /*+ `foo @bar` */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near 'foo @bar` */ 1' at line 1
SELECT /*+ DEBUG_HINT1( @) */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near ') */ 1' at line 1
SELECT /*+ DEBUG_HINT1( @) */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near ') */ 1' at line 1
SELECT /*+ DEBUG_HINT1(t1 @) */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '@) */ 1' at line 1

# We don't support "*/" inside quoted identifiers (syntax error):

SELECT /*+ DEBUG_HINT(`test*/`) */ 1;
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '`) */ 1' at line 1

# valid hint sequences:

SELECT  /*+ DEBUG_HINT2() */ 1;
1
1
SELECT  /*+DEBUG_HINT2()*/ 1;
1
1
SELECT  /*+ DEBUG_HINT2 () */ 1;
1
1
SELECT  /*+ DEBUG_HINT2 (  ) */ 1;
1
1
SELECT  /*+ DEBUG_HINT2() */ 1 UNION SELECT 1;
1
1
(SELECT /*+ DEBUG_HINT2() */ 1) UNION (SELECT 1);
1
1
((SELECT  /* + DEBUG_HINT2() */ 1));
1
1
UPDATE  /*+ DEBUG_HINT2() */ t1 SET i = 10;
INSERT  /*+ DEBUG_HINT2() */ INTO t1 VALUES ();
REPLACE /*+ DEBUG_HINT2() */ INTO t1 VALUES ();
DELETE  /*+ DEBUG_HINT2() */ FROM t1 WHERE 1;
SELECT /*+ DEBUG_HINT1(t1) */    1 FROM t1;
1
# Valid QB name:
SELECT /*+ DEBUG_HINT1(@QB1 a) */   1 FROM t1 a;
1
# Invalid, `cause QB name must start with @
SELECT /*+ DEBUG_HINT1(a b) */   1 FROM t1 a, t1 b;
1
Warnings:
Warning	1064	Optimizer hint syntax error near 'b) */   1 FROM t1 a, t1 b' at line 1
SELECT /*+ DEBUG_HINT2(i1) */ 1 FROM t1;
1
SELECT /*+ DEBUG_HINT2(i1, i2) */ 1 FROM t1;
1
#
# test explainable statements for hint support:
# they should warn with a hint syntax error near "test */"
#
EXPLAIN SELECT /*+ test */ 1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	NULL	NULL	NULL	NULL	NULL	NULL	NULL	No tables used
Warnings:
Warning	1064	Optimizer hint syntax error near 'test */ 1' at line 1
EXPLAIN INSERT /*+ test */ INTO t1 VALUES (10, 10);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	INSERT	t1	ALL	NULL	NULL	NULL	NULL	NULL	NULL
Warnings:
Warning	1064	Optimizer hint syntax error near 'test */ INTO t1 VALUES (10, 10)' at line 1
EXPLAIN REPLACE /*+ test */ INTO t1 VALUES (10, 10);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	INSERT	t1	ALL	NULL	NULL	NULL	NULL	NULL	NULL
Warnings:
Warning	1064	Optimizer hint syntax error near 'test */ INTO t1 VALUES (10, 10)' at line 1
EXPLAIN UPDATE /*+ test */ t1 SET i = 10 WHERE j = 10;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	NULL	NULL	NULL	NULL	NULL	NULL	NULL	Impossible WHERE
Warnings:
Warning	1064	Optimizer hint syntax error near 'test */ t1 SET i = 10 WHERE j = 10' at line 1
EXPLAIN DELETE /*+ test */ FROM t1 WHERE i = 10;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	NULL	NULL	NULL	NULL	NULL	NULL	NULL	Impossible WHERE
Warnings:
Warning	1064	Optimizer hint syntax error near 'test */ FROM t1 WHERE i = 10' at line 1

# non-alphabetic and non-ASCII identifiers:

CREATE INDEX 3rd_index ON t1(i, j);
SELECT /*+ DEBUG_HINT2(3rd_index) */ 1 FROM t1;
1
CREATE INDEX $index ON t1(j, i);
SELECT /*+ DEBUG_HINT2($index) */ 1 FROM t1;
1
CREATE TABLE ` quoted name test` (i INT);
SELECT /*+ DEBUG_HINT1(` quoted name test`) */ 1 FROM t1;
1
SELECT /*+ DEBUG_HINT1(` quoted name test`@`select#1`) */ 1 FROM t1;
1
DROP TABLE ` quoted name test`;
SET SQL_MODE = 'ANSI_QUOTES';
CREATE TABLE " quoted name test" (i INT);
SELECT /*+ DEBUG_HINT1(" quoted name test") */ 1 FROM t1;
1
SELECT /*+ DEBUG_HINT1(" quoted name test"@"select#1") */ 1 FROM t1;
1
CREATE TABLE `test1``test2``` (i INT);
SELECT /*+ DEBUG_HINT1(`test1``test2```) */ 1;
1
1
SELECT /*+ DEBUG_HINT1("test1""test2""") */ 1;
1
1
SET SQL_MODE = '';
# should warn:
SELECT /*+ DEBUG_HINT1(" quoted name test") */ 1 FROM t1;
1
Warnings:
Warning	1064	Optimizer hint syntax error near '" quoted name test") */ 1 FROM t1' at line 1
DROP TABLE ` quoted name test`;
DROP TABLE `test1``test2```;
SET NAMES utf8;
CREATE TABLE tableТ (i INT);
SELECT /*+ DEBUG_HINT1(tableТ) */ 1 FROM t1;
1
SELECT /*+ DEBUG_HINT1(test@tableТ) */ 1 FROM t1;
1
DROP TABLE tableТ;
CREATE TABLE таблица (i INT);
SELECT /*+ DEBUG_HINT1(`таблица`) */ 1 FROM t1;
1
SELECT /*+ DEBUG_HINT1(таблица) */ 1 FROM t1;
1
SELECT /*+ DEBUG_HINT1(test@таблица) */ 1 FROM t1;
1
DROP TABLE таблица;

# derived tables and other subqueries:

SELECT * FROM (SELECT /*+ DEBUG_HINT3 */ 1) a;
1
1
Warnings:
Warning	1064	This warning is expected near 'DEBUG_HINT3 */ 1) a' at line 1
SELECT (SELECT /*+ DEBUG_HINT3 */ 1);
(SELECT /*+ DEBUG_HINT3 */ 1)
1
Warnings:
Warning	1064	This warning is expected near 'DEBUG_HINT3 */ 1)' at line 1
SELECT 1 FROM DUAL WHERE 1 IN (SELECT /*+ DEBUG_HINT3 */ 1);
1
1
Warnings:
Warning	1064	This warning is expected near 'DEBUG_HINT3 */ 1)' at line 1

# invalid hint sequences (should warn):

SELECT /*+ 10 */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '10 */ 1' at line 1
SELECT /*+ DEBUG_HINT1() */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near ') */ 1' at line 1
SELECT /*+ DEBUG_HINT1(10) */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '10) */ 1' at line 1
SELECT /*+ DEBUG_HINT1( */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '*/' at line 1
SELECT /*+ DEBUG_HINT1) */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near ') */ 1' at line 1
SELECT /*+ DEBUG_HINT1(t1 */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '*/' at line 1
SELECT /*+ DEBUG_HINT1(t1 ( */ 1;
1
1
Warnings:
Warning	1064	Optimizer hint syntax error near '( */ 1' at line 1
(SELECT 1) UNION (SELECT /*+ DEBUG_HINT2() */ 1);
1
1

# wrong place for hint, so recognize that stuff as a regular commentary:

SELECT 1 FROM /*+ regular commentary, not a hint! */ t1;
1
SELECT 1 FROM /*+ #1 */ t1 WHERE /*+ #2 */ 1 /*+ #3 */;
1
SELECT /*+ DEBUG_HINT2() */ 1
FROM /*+ regular commentary, not a hint! */ t1;
1
DROP TABLE t1;
SELECT /*+ 10;
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '/*+ 10' at line 1
